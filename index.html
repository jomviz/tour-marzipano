<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Tour 360° Casa - Marzipano</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body, html { margin:0; padding:0; height:100%; overflow:hidden; background:#000; }
        #pano { width:100%; height:100%; }
        .scene-selector {
            position:absolute; bottom:20px; left:50%; transform:translateX(-50%);
            background:rgba(0,0,0,0.75); border-radius:12px; padding:10px 16px;
            color:white; z-index:9999; display:flex; gap:12px; align-items:center;
        }
        .scene-selector button { background:none; border:none; color:white; font-size:28px; cursor:pointer; padding:0 8px; }
        .scene-selector select { background:rgba(255,255,255,0.15); color:white; border:none; padding:10px 14px; border-radius:8px; font-size:16px; min-width:240px; }
    </style>
    <!-- Marzipano JS CDN (versión real) -->
<script src="https://cdn.jsdelivr.net/npm/marzipano@0.10.2/dist/marzipano.js"></script>
<!-- CSS CDN (versión real) -->
<link href="https://cdn.jsdelivr.net/npm/marzipano@0.10.2/dist/marzipano.css" rel="stylesheet">
</head>
<body>
    <div id="pano"></div>

    <div class="scene-selector">
        <button onclick="prev()">←</button>
        <select id="scenes" onchange="switchScene(this.value)"></select>
        <button onclick="next()">→</button>
    </div>

    <script>
        const viewer = new Marzipano.Viewer(document.getElementById('pano'));

        // Tus 4 imágenes reales (agregá m5 y m6 cuando las subas)
        const scenesData = [
            { id: "m1", title: "1. Ingreso", file: "m1.jpg" },
            { id: "m2", title: "2. Cocina / Comedor", file: "m2.jpg" },
            { id: "m3", title: "3. Estudio", file: "m3.jpg" },
            { id: "m4", title: "4. Patio", file: "m4.jpg" }
            // { id: "m5", title: "5. Terraza", file: "m5.jpg" },
            // { id: "m6", title: "6. Sala de juegos", file: "m6.jpg" }
        ];

        const sceneList = {};
        let currentIndex = 0;

        scenesData.forEach((s, i) => {
            // FIX 1: Source con template {f} para URLs externas
            const source = Marzipano.ImageUrlSource.fromString("{f}");
            const geometry = new Marzipano.EquirectGeometry([{ width: 8192 }]); // Cambiá a tu resolución real (ej: 4096 si son más chicas)
            const limiter = Marzipano.RectilinearView.limit.traditional(4096, 100 * Math.PI / 180, 120 * Math.PI / 180);
            const view = new Marzipano.RectilinearView({ yaw: 0, pitch: 0 }, limiter);

            // FIX 2: TextureStore para cargar imágenes
            const textureStore = new Marzipano.TextureStore(source, viewer);

            const scene = viewer.createScene({
                source: source,
                geometry: geometry,
                view: view,
                textureStore: textureStore,
                pinFirstLevel: true
            });

            // FIX 3: addImageUrl con la URL real de GitHub raw
            scene.addImageUrl("https://raw.githubusercontent.com/jomviz/tour-marzipano/main/" + s.file);

            sceneList[s.id] = { scene: scene, index: i };

            // Hotspot ejemplo (para m1 → m2)
            if (i === 0) {
                const hotspot = scene.hotspotContainer().createHotspot(document.createElement("div"), 
                    { yaw: 0.3, pitch: 0 }, 
                    { perspective: { radius: 300, extraTransforms: "rotateX(0deg)" } }
                );
                hotspot.element.innerHTML = '<div style="background:#007bff;color:white;padding:8px 12px;border-radius:8px;cursor:pointer;">→ Cocina</div>';
                hotspot.element.onclick = () => switchScene("m2");
            }
        });

        // Selector
        const select = document.getElementById('scenes');
        scenesData.forEach((s, i) => {
            const opt = new Option(s.title, s.id);
            select.add(opt);
        });

        function switchScene(id) {
            const scene = sceneList[id].scene;
            scene.switchTo({ transitionDuration: 800 });
            currentIndex = sceneList[id].index;
            select.value = id;
        }

        function next() { 
            const idx = (currentIndex + 1) % scenesData.length; 
            switchScene(scenesData[idx].id); 
        }
        function prev() { 
            const idx = (currentIndex - 1 + scenesData.length) % scenesData.length; 
            switchScene(scenesData[idx].id); 
        }

        // Inicio
        switchScene("m1");
    </script>
</body>
</html>
